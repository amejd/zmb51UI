sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/format/DateFormat","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/ui/core/format/NumberFormat","sap/m/MessageBox"],function(t,e,n,o,r,l,a,i,s){"use strict";return t.extend("zmb51ui.controller.Main",{onInit:function(){const t=this;const e=this.getView().byId("smartFilterBar");e.attachSearch(function(){console.log(sap.ui.getCore().byId("application-zmb51ui-display-component---Main--smartFilterBar-filterItemControlA_-Article-valueHelpDialog-smartFilterBar-filterItemControlA_-Matnr-valueHelpDialog"));const n=t.getView().byId("BusyDialog");n.open();const o=e.getFilterData().Article;const r=e.getFilterData().GrpMarchandise;const l=e.getFilterData().Division;const a=e.getFilterData().MVT;const i=e.getFilterData().DateComptable;console.log(r);console.log(o);if(!r&&!o){s.error(t.getOwnerComponent().getModel("i18n").getResourceBundle().getText("errMsg"));n.close();return}let c=new Array;o&&o.items.map(t=>t.text).map(e=>{c.push(t._onGetFilters(e,"Article"))});r&&r.items.map(t=>t.text).map(e=>{c.push(t._onGetFilters(e,"GrpMarchandise"))});l&&l.items.map(t=>t.text).map(e=>{c.push(t._onGetFilters(e,"Division"))});a&&a.items.map(t=>t.text).map(e=>{c.push(t._onGetFilters(e,"MVT"))});i&&c.push(t._onGetFilters(i,"DateComptable"));const d=t.getOwnerComponent().getModel();d.read("/ZCDS_CN_MSEG",{filters:c,success:function(e){console.log(e);if(e){const o=new sap.ui.model.json.JSONModel(e.results);console.log(e.results);e.results.map(e=>{e.DateComptable=t._formatDate(e.DateComptable);e.QteEnUQS=t._formatNumber(e.QteEnUQS,13,2);e.QteEnUQ=t._formatNumber(e.QteEnUQ,13,3);e.Quantite=t._formatNumber(e.Quantite,13,3);e.MontantAchat=Number(e.MontantAchat)!=0?t._formatNumber(e.MontantAchat,13,2):"";e.UQVar=Number(e.UQVar)!=0?t._formatUQVar(e.UQVar):"";return e});e.results.sort((t,e)=>{const n=t.Poste;const o=e.Poste;if(n<o){return-1}else if(n>o){return 1}else{return 0}});t.getView().byId("title").setText(`${t.getOwnerComponent().getModel("i18n").getResourceBundle().getText("titleTable")} (${e.results.length})`);t.getView().byId("table").setModel(o);n.close()}},error:function(t){console.log("******************************************************** ERROR MSEG CALL ");console.log(t);alert("Error reading data from backend system ! ")}})},{passive:true})},onExtractDataJS:function(){const t=this.getView().byId("BusyDialog");t.open();const e=this.getView().byId("smartFilterBar");const n=this.getView().byId("table");const o=n.getBinding("rows");let l="application/vnd.ms-excel";const a=this.createId("hiddenLink");let i=document.getElementById(a);const s=e.getFilterData().Article;const c=e.getFilterData().GrpMarchandise;const d=e.getFilterData().Division;const p=e.getFilterData().MVT;const h=e.getFilterData().DateComptable;if(!c&&!h){r.show("Aucun des filtres obligatoires n'a été sélectionné.");t.close();return}let m=[];s&&s.items.map(t=>t.text).map(t=>{m.push(t)});let b=[];c&&c.items.map(t=>t.text).map(t=>{b.push(t)});let g=[];d&&d.items.map(t=>t.text).map(t=>{g.push(t)});let u=[];p&&p.items.map(t=>t.text).map(t=>{u.push(t)});let x={};if(h){x.min=h.low;x.max=h.high}if(o&&o.getLength()>0){const e=this._onGetHTMLCodeOfExcel(m,b,g,u,x,o.oList);i.href=`data:${l}, ${e}`;i.download=`Extraction-${this._formatDate(new Date)}.xls`;i.click();t.close()}else{r.show("No data bound ");t.close();return}},onNavigateMM03:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const o=n&&n.hrefForExternal({target:{semanticObject:"Material",action:"display"},params:{Material:e}})||"";const r=window.location.href.split("#")[0]+o;sap.m.URLHelper.redirect(r,true)},onNavigateF1077:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const o=n&&n.hrefForExternal({target:{semanticObject:"MaterialDocument",action:"displayFactSheet"},params:{MaterialDocument:e}})||"";const r=window.location.href.split("#")[0]+o;sap.m.URLHelper.redirect(r,true)},onNavigateBMBC:function(t){const e=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const n=e&&e.hrefForExternal({target:{semanticObject:"Batch",action:"monitor"}})||"";const o=window.location.href.split("#")[0]+n;sap.m.URLHelper.redirect(o,true)},onNavigateMSC3N:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const o=n&&n.hrefForExternal({target:{semanticObject:"Batch",action:"display"},params:{Batch:e}})||"";const r=window.location.href.split("#")[0]+o;sap.m.URLHelper.redirect(r,true)},onNavigateME23N:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const o=n&&n.hrefForExternal({target:{semanticObject:"ZSO_ZTRCME23N",action:"display"},params:{Ebeln:e}})||"";const r=window.location.href.split("#")[0]+o;sap.m.URLHelper.redirect(r,true)},_onGetFilters:function(t,o){if(o=="DateComptable"){console.log(t);const r=new e(o,n.BT,t.low,t.high);return r}else{const r=new e(o,n.EQ,t);return r}},_formatDate:function(t){if(!t){return""}const e=o.getDateInstance({pattern:"dd.MM.yyyy"});return e.format(new Date(t))},_formatNumber:function(t,e,n){var o=t-Math.floor(t)!==0;let r={};r={minIntegerDigits:1,maxIntegerDigits:e,minFractionDigits:n,maxFractionDigits:n};var l=i.getFloatInstance(r);let a=l.format(Number(t));return a},_formatUQVar:function(t){var e=sap.ui.core.format.NumberFormat.getFloatInstance({style:"short",shortDecimals:1});var n=e.format(t);return n},_onGetHTMLCodeOfExcel:function(t,e,n,o,r,l){const a=this.getOwnerComponent().getModel("i18n").getResourceBundle();const i=a.getText("title");const s=this._formatDate(new Date);const c=a.getText("para");let d=`<div id="allfile">\n                                    <div class="container">\n                                    <h3>${i}</h3>\n                                    <p style="margin-bottom: 5px;"><b>Date&nbsp;:</b>&nbsp;${s}</p>\n                                    <p style="margin-bottom: 0;  margin-top: 0px">${c}</p>\n                                    <ul style="margin-top: 3px;">\n                                        <li><strong>Article&nbsp;:</strong>${t.length>0?t.join(","):"Aucun"}</li>\n                                        <li><strong>Groupe de marchandise&nbsp;:</strong>${e.length>0?e.join(","):"Aucun"}</li>\n                                        <li><strong>Division&nbsp;:</strong>${n.length>0?n.join(","):"Aucun"}</li>\n                                        <li><strong>Code MVT&nbsp;:</strong>${o.length>0?o.join(","):"Aucun"}</li>\n                                        <li><strong>Date Comptable&nbsp;:</strong>Du&nbsp;${this._formatDate(r.min)}&nbsp;Au&nbsp;${this._formatDate(r.max)}</li>\n                                    </ul>\n                                    </div>\n                                    <table id="customersTable" style="font-family:arial, sans-serif;border: 1px solid black; border-collapse: collapse;">\n                                    <thead>\n                                        <tr>\n                                        <th style="width: 10em; border: 1px solid black;">Article</th>\n                                        <th style="width: 15em; border: 1px solid black;">Description article</th>\n                                        <th style="width: 15em; border: 1px solid black;">Groupe de marchandise</th>\n                                        <th style="width: 20em; border: 1px solid black;">Description groupe de marchandise</th>\n                                            <th style="width: 10em; border: 1px solid black;">Division</th>\n                                            <th style="width: 10em; border: 1px solid black;">Magasin</th>\n                                            <th style="width: 10em; border: 1px solid black;">MVT</th>\n                                            <th style="width: 10em; border: 1px solid black;">Document article</th>\n                                            <th style="width: 10em; border: 1px solid black;">Document d'achat</th>\n                                            <th style="width: 10em; border: 1px solid black;">Poste</th>\n                                            <th style="width: 10em; border: 1px solid black;">Date comptable</th>\n                                            <th style="width: 10em; border: 1px solid black;">${a.getText("QteEnUQS")}</th>\n                                            <th style="width: 10em; border: 1px solid black;">UQ de saisie</th>\n                                            <th style="width: 15em; border: 1px solid black;">Qte unite de base (UQ)</th>\n                                            <th style="width: 10em; border: 1px solid black;">UQ de base</th>\n                                            <th style="width: 10em; border: 1px solid black;">UQ var</th>\n                                            <th style="width: 10em; border: 1px solid black;">Lot fournisseur</th>\n                                            <th style="width: 20em; border: 1px solid black;">${a.getText("LotQualite")}</th>\n                                            \n                                            <th style="width: 10em; border: 1px solid black;">Montant achat</th>\n                                            <th style="width: 10em; border: 1px solid black;">Devise</th>\n                                            <th style="width: 10em; border: 1px solid black;">${a.getText("Quantite")}</th>\n                                            <th style="width: 10em; border: 1px solid black;">Client</th>\n                                            <th style="width: 10em; border: 1px solid black;">Nom du client</th>\n                                            <th style="width: 10em; border: 1px solid black;">Fournisseur</th>\n                                            <th style="width: 15em; border: 1px solid black;">${a.getText("LotExt")}</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                   \n                                            ${l&&l.map(t=>`<tr>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Article}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.DescriptionArticle}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.GrpMarchandise}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.DescGrpMarchandise}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Division}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Magasin}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.MVT}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.NumeroDoc}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.CdeAch}</td>   \n                                                            <td style="border: 1px solid black;text-align:center;">${t.Poste}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.DateComptable}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.QteEnUQS}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.UQDeSaisie}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.QteEnUQ}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.UQDeBase}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.UQVar}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.LotFournisseur}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.LotQualite}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.MontantAchat}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Devise}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Quantite}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.ZClient}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.NomClient}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Fournisseur}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.LotEntreposageExt}</td>\n                                                        </tr>`).join("")}\n                                            \n                                            \n                                 \n                                    </tbody>\n                                    </table>\n                                </div>\n                                `;let p=`\n                <!DOCTYPE html>\n                <html lang="en">\n                \n                <head>\n                  <meta charset="UTF-8">\n                  <meta http-equiv="X-UA-Compatible" content="IE=edge">\n                  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                  <title>ss</title>\n                </head>\n                <body>\n                    ${d}\n                </body>\n                </html>\n                `;d=p.replace(/ /g,"%20");return d},onClearAllFilters:function(){const t=this.byId("table");const e=t.getBinding();t.clearSelection();if(e){e.aSorters=null;e.aFilters=null}for(let e=0;e<t.getColumns().length;e++){t.getColumns()[e].setSorted(false);t.getColumns()[e].setFilterValue("");t.getColumns()[e].setFiltered(false)}e.filter([])}})});
//# sourceMappingURL=Main.controller.js.map